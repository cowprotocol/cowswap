


import{l as J,o as C,S as G,r as p,m as At,P as He,a4 as m,a9 as Ie,aa as Te,a5 as j,x as n,bp as $e,a1 as F,g as R,Q as re,J as _e,aA as Ce,aq as V,ad as Ye,b7 as Ze,bq as vt,b4 as Qe,b5 as Je,cO as be,cP as Ae,v as St,p as Ot,cj as Rt,F as ke,cQ as jt,cR as Lt,b2 as Et,Y as _t,Z as kt}from"./vendor-35db3a09.js";import{u as M,a as te,b as Ft,i as $,g as Pt,U as L,T as ce,c as Y,N as Mt,d as ve,e as le,H as Nt,f as Dt,h as Wt,Z as Ut,S as zt,B as Bt,j as Vt,k as H,F as W,l as qt,m as Q,n as Kt,o as Xt,t as he,p as Gt,q as Ht,r as $t,s as Yt,v as Zt,w as O,x as Z,y as Qt,z as et,A as tt,C as Jt,D as en,E as tn,I as nt,J as ot,K as nn,L as on,O as it,Q as rn,R as an,V as sn,W as cn,X as ln,Y as dn,_ as Se,$ as ae,a0 as un,a1 as pn,a2 as mn,a3 as rt,a4 as ye,a5 as fn,a6 as at,a7 as xn,a8 as gn,a9 as hn,aa as yn,ab as de,ac as wn,ad as In,ae as Tn,af as st,ag as ct,ah as Cn,ai as bn,aj as An,ak as lt,al as vn,am as Sn,an as On,ao as Rn,ap as jn,aq as Ln,ar as En,as as _n,at as kn,au as Fn,av as Pn,aw as Mn,ax as Nn,ay as Dn,az as Wn,aA as Un,aB as Fe,aC as Pe,aD as Me,aE as zn,aF as Bn,aG as Vn}from"./index-a8951d67.js";import{a as qn,c as Kn,r as Xn,u as Gn,b as dt,T as Hn,d as $n,S as ge,e as Yn,U as Zn,P as Qn,f as Jn,g as eo,O as to,h as no}from"./index-a69a2960.js";const oo=()=>({isInverted:!1,isLoading:!1,isLoadingMarketRate:!1,initialRate:null,activeRate:null,marketRate:null,feeAmount:null,isTypedValue:!1,isRateFromUrl:!1,typedValue:null}),{atom:K,updateAtom:ue}=qn(J(oo()));var D;(function(e){e.RateLoading="RateLoading",e.FeeExceedsFrom="FeeExceedsFrom",e.PriceIsNotSet="PriceIsNotSet",e.ZeroPrice="ZeroPrice"})(D||(D={}));function io(e){const{activeRate:t,isRateLoading:o,feeAmount:i,sellAmount:r,buyAmount:a}=e;return $(t)?D.PriceIsNotSet:o?D.RateLoading:!r?.equalTo(0)&&a?.toExact()==="0"||!a?.equalTo(0)&&a?.toExact()==="0"?D.ZeroPrice:r&&i?.greaterThan(r)?D.FeeExceedsFrom:null}function Oe(){const{inputCurrencyAmount:e,outputCurrencyAmount:t}=M(),o=te(),{activeRate:i,isLoading:r}=C(K),a=o?.response?.quote?.feeAmount,c=a&&e?G.fromRawAmount(e.currency,a):null,s={activeRate:i,feeAmount:c,isRateLoading:r,sellAmount:e,buyAmount:t};return Ft(()=>io(s),Object.values(s))}function pe(){const{activeRate:e,marketRate:t,isLoading:o,isLoadingMarketRate:i}=C(K);return p.useMemo(()=>{const r=!e||e.equalTo(0),a=!t||t.equalTo(0);if(r||a||o||i)return 0;const c=+e.divide(t).multiply(100).subtract(100).toFixed(1);return!c||!Number.isFinite(c)||Number.isNaN(c)?0:c},[e,t,o,i])}const ro=18e5,ao=Math.round(315576e5/2),ut={title:"7 Days",value:6048e5},we=[{title:"5 Minutes",value:3e5},{title:"30 Minutes",value:18e5},{title:"1 Hour",value:36e5},{title:"1 Day",value:864e5},{title:"3 Days",value:2592e5},ut,{title:"1 Month",value:2592e6}],me=J(void 0),so={expertMode:!1,showRecipient:!1,partialFillsEnabled:!0,deadlineMilliseconds:ut.value,customDeadlineTimestamp:null},U=At("limit-orders-settings-atom:v2",so,Pt()),pt=J(null,(e,t,o)=>{t(U,()=>{const i=e(U);return o.partialFillsEnabled!==i.partialFillsEnabled&&t(me,void 0),{...i,...o}})}),se=J({isRateImpactAccepted:!1,isPriceImpactAccepted:!1}),co=J(null,(e,t,o)=>{t(se,()=>({...e(se),...o}))}),lo=new He(0),ne=-5,uo=m.div.withConfig({displayName:"RateImpactWarning__RateImpactWarningBox",componentId:"sc-1e1ft4h-0"})(["display:flex;align-items:center;border-radius:",";padding:16px;gap:16px;color:",";background:",";font-size:14px;font-weight:500;line-height:1.4;"],({withAcknowledge:e})=>e?"18px 18px 0 0":"18px",({theme:e})=>e.darkMode?Ie(.2,e.danger):Te(.05,e.danger),({theme:e})=>e.darkMode?j(.8,e.danger):j(.85,e.danger)),po=m.a.withConfig({displayName:"RateImpactWarning__ReadMoreLink",componentId:"sc-1e1ft4h-1"})(["display:block;color:inherit;margin:16px 0 0;text-decoration:underline;&:hover{color:var(",");}"],L.COLOR_TEXT1),mo=m.div.withConfig({displayName:"RateImpactWarning__AcknowledgeBox",componentId:"sc-1e1ft4h-2"})(["color:",";background:",";text-align:center;padding:16px 0;border-radius:0 0 16px 16px;label{cursor:pointer;}input{margin-right:5px;}"],({theme:e})=>e.darkMode?Ie(.2,e.danger):Te(.05,e.danger),({theme:e})=>e.darkMode?j(.8,e.danger):j(.85,e.danger));function fo({withAcknowledge:e=!1,onAcknowledgeChange:t,isAccepted:o,rateImpact:i,inputCurrency:r,className:a}){return i<ne?n.jsxs("div",{className:a,children:[n.jsxs(uo,{withAcknowledge:e,children:[n.jsx("div",{children:n.jsx($e,{size:32})}),n.jsxs("div",{children:["Your limit price is ",Math.abs(i),"% lower than current market price. You could be selling your"," ",n.jsx(ce,{token:r})," at a loss (although CoW Swap will always try to give you the best price regardless).",n.jsx(po,{target:"_blank",href:"https://www.investopedia.com/terms/l/limitorder.asp",children:"Read more about limit orders"})]})]}),e&&n.jsx(mo,{children:n.jsxs("label",{children:[n.jsx("input",{type:"checkbox",checked:o,onChange:s=>t?.(s.target.checked)}),n.jsx("span",{children:"I acknowledge the high price impact"})]})})]}):null}const xo=[Y.ExpertApproveAndSwap,Y.ApproveAndSwap],go=m.div.withConfig({displayName:"LimitOrdersWarnings__Wrapper",componentId:"sc-nvwn7t-0"})(["display:flex;flex-flow:column wrap;gap:10px;"]),ho=m(Mt).withConfig({displayName:"LimitOrdersWarnings__StyledNoImpactWarning",componentId:"sc-nvwn7t-1"})(["margin:10px auto 0;"]),yo=m(fo).withConfig({displayName:"LimitOrdersWarnings__StyledRateImpactWarning",componentId:"sc-nvwn7t-2"})(["margin:10px auto 0;"]);function mt(e){const{priceImpact:t,feeAmount:o,isConfirmScreen:i=!1,className:r}=e,{isPriceImpactAccepted:a,isRateImpactAccepted:c}=C(se),s=F(co),{expertMode:u}=C(U),l=Oe(),d=ve(),f=pe(),{chainId:g,account:x}=le(),{slippageAdjustedSellAmount:h,inputCurrency:y,inputCurrencyAmount:T,outputCurrency:I,outputCurrencyAmount:v}=M(),b=te(),S=l===null&&d===null&&!b.error,_=S&&!b.isLoading&&!!g&&!u&&!!x&&!!t.error,A=S&&!b.isLoading&&y&&!$(T)&&!$(v),E=Kn({value:o,reference:T}),w=E?.greaterThan(Nt),k=!i&&d&&xo.includes(d),N=Dt(h),B=N&&I!==null,X=Wt(),P=!i&&!k&&X&&d===Y.ApproveRequired,fe=_||f<0||w||k||P||N;p.useEffect(()=>{s({isPriceImpactAccepted:!_})},[_,s]),p.useEffect(()=>{i&&s({isRateImpactAccepted:!1})},[s,i]);const xe=p.useCallback(()=>{s({isPriceImpactAccepted:!a})},[s,a]),Ct=p.useCallback(bt=>{s({isRateImpactAccepted:bt})},[s]);return fe?n.jsxs(go,{className:r,children:[B&&n.jsx(Ut,{currency:y}),_&&n.jsx(ho,{withoutAccepting:i,isAccepted:a,acceptCallback:xe}),A&&n.jsx(yo,{withAcknowledge:i,isAccepted:c,rateImpact:f,inputCurrency:y,onAcknowledgeChange:Ct}),w&&n.jsx(zt,{feeAmount:o,feePercentage:E}),k&&n.jsx(Bt,{}),P&&n.jsx(Vt,{})]}):null}function ft(){const e=F(H),{inputCurrency:t,outputCurrency:o}=M();return p.useCallback(i=>{const{activeRate:r,amount:a,orderKind:c}=i,s=c===R.OrderKind.SELL?W.INPUT:W.OUTPUT,u=qt({activeRate:r,amount:a,field:s,inputCurrency:t,outputCurrency:o}),l={orderKind:c,inputCurrencyAmount:Q.serializeFractionToJSON(s===W.INPUT?a:u),outputCurrencyAmount:Q.serializeFractionToJSON(s===W.OUTPUT?a:u)};e(l)},[t,o,e])}function xt(e,t){const{numerator:o,denominator:i}=e,r=e.currency.decimals,a=t.decimals;if(r===a)return G.fromFractionalAmount(t,o,i);const c=Math.abs(r-a),s=Xn(1,c),u=r<a?_e.multiply(o,s):_e.divide(o,s);return G.fromFractionalAmount(t,u,i)}function wo(e){const{inputCurrencyAmount:t,outputCurrencyAmount:o,feeAmount:i,marketRate:r}=e;if(!t||!o||!i||!r||t.equalTo(0)||t.currency!==i.currency)return null;const a=r.lessThan(1),c=a?r.invert():r,s=new re({baseAmount:t,quoteAmount:xt(t.subtract(i).multiply(c),o.currency)}),u=a?s.invert():s,l=new re({baseAmount:t.subtract(i),quoteAmount:o});return l.lessThan(u)?u:l}function Io(){const{inputCurrencyAmount:e,outputCurrencyAmount:t}=M(),o=Kt(),i=F(H);return p.useCallback((r,a)=>{if(a){const c=r===W.INPUT?"inputCurrencyAmount":"outputCurrencyAmount",s=r===W.INPUT?e:t;if(s){const u=xt(s,a);return o(r,a,()=>{i({[c]:Q.serializeFractionToJSON(u)})})}}return o(r,a)},[o,i,e,t])}function To(){const{inputCurrency:e,outputCurrency:t,orderKind:o}=M(),{activeRate:i}=C(K),r=Xt(),a=ft(),c=F(H),s=Io(),u=p.useCallback((f,g)=>{const x=f===W.INPUT?e:t;if(!x)return;const h=he(g,x)||null;Gt(f,Number(g)),a({activeRate:i,amount:h,orderKind:r||f===W.INPUT?R.OrderKind.SELL:R.OrderKind.BUY})},[a,r,e,t,i]),l=Gn({orderKind:o===R.OrderKind.SELL?R.OrderKind.BUY:R.OrderKind.SELL}),d=p.useCallback(f=>{c({recipient:f})},[c]);return{onUserInput:u,onSwitchTokens:l,onChangeRecipient:d,onCurrencySelection:s}}function Co(e){const t=e?.postOrderParams.sellToken,o=Ht(t?.address),i=$t(),r=Yt();return!e||!o||!i||!r?null:{...e,erc20Contract:o,spender:i,safeAppsSdk:r}}class Re extends Error{}function je(e){return e.customDeadlineTimestamp?e.customDeadlineTimestamp:Zt(e.deadlineMilliseconds/1e3)}const z="LIMIT ORDER SAFE BUNDLE FLOW";async function bo(e,t,o,i,r){if(O(z,"STEP 1: confirm price impact"),!(e.rateImpact<ne)&&t.priceImpact&&!await i(t.priceImpact))throw new Re;const{account:c,recipientAddressOrName:s,sellToken:u,buyToken:l,inputAmount:d,class:f}=e.postOrderParams,g={account:c,recipient:s,recipientAddress:s,marketLabel:[u.symbol,l.symbol].join(","),orderClass:f};O(z,"STEP 2: send transaction"),Z.approveAndPresign(g),r?.();const{chainId:x,postOrderParams:h,provider:y,erc20Contract:T,spender:I,dispatch:v,settlementContract:b,safeAppsSdk:S}=e,_=je(o);try{O(z,"STEP 2: build approval tx");const A=await Qt({erc20Contract:T,spender:I,amountToApprove:d});O(z,"STEP 3: post order");const{id:E,order:w}=await et({...h,signer:y.getSigner(),validTo:_});O(z,"STEP 4: add order, but hidden"),tt({id:E,chainId:x,order:{...w,isHidden:!0}},v),O(z,"STEP 5: build presign tx");const k=await Jt({settlementContract:b,orderId:E});O(z,"STEP 6: send safe tx");const N=[{to:A.to,data:A.data,value:"0",operation:0},{to:k.to,data:k.data,value:"0",operation:0}];if(await en({tokenContract:T,spender:I,amountToApprove:d,isBundle:!0})){const P=await tn({erc20Contract:T,spender:I,currency:d.currency});N.unshift({to:P.to,data:P.data,value:"0",operation:0})}const X=await S.txs.send({txs:N});return O(z,"STEP 7: add safe tx hash and unhide order"),nt({chainId:x,order:{id:w.id,presignGnosisSafeTxHash:X.safeTxHash,isHidden:!1}},v),Z.sign(g),E}catch(A){O(z,"STEP 8: ERROR: ",A);const E=ot(A);throw Z.error(A,E,g),A}}async function Ao(e,t,o,i,r){const{account:a,recipientAddressOrName:c,sellToken:s,buyToken:u}=e.postOrderParams,l=[s.symbol,u.symbol].join(","),d={account:a,recipient:c,recipientAddress:c,marketLabel:l,orderClass:R.OrderClass.LIMIT};if(O("LIMIT ORDER FLOW","STEP 1: confirm price impact"),!(e.rateImpact<ne)&&t.priceImpact&&!await i(t.priceImpact))throw new Re;O("LIMIT ORDER FLOW","STEP 2: send transaction"),Z.trade(d),r?.();const g=je(o);try{O("LIMIT ORDER FLOW","STEP 3: sign and post order");const{id:x,order:h}=await et({...e.postOrderParams,signer:e.provider.getSigner(),validTo:g});O("LIMIT ORDER FLOW","STEP 4: add pending order step"),tt({id:x,chainId:e.chainId,order:{...h,isHidden:!e.allowsOffchainSigning}},e.dispatch),O("LIMIT ORDER FLOW","STEP 5: presign order (optional)");const y=await(e.allowsOffchainSigning?Promise.resolve(null):nn(x,e.settlementContract));return O("LIMIT ORDER FLOW","STEP 6: unhide SC order (optional)"),y&&nt({chainId:e.chainId,order:{id:h.id,presignGnosisSafeTxHash:e.isGnosisSafeWallet?y.hash:void 0,isHidden:!1}},e.dispatch),O("LIMIT ORDER FLOW","STEP 7: Sign order"),Z.sign(d),x}catch(x){O("LIMIT ORDER FLOW","STEP 8: ERROR: ",x);const h=ot(x);throw Z.error(x,h,d),x}}function gt(e,t,o,i){const{confirmPriceImpactWithoutFee:r}=on(),a=F(H),[c,s]=Ce(me),u=Co(e),l=it(e?.postOrderParams.inputAmount),d=p.useCallback(()=>{if(!e)return;const g={inputAmount:e.postOrderParams.inputAmount,outputAmount:e.postOrderParams.outputAmount};i.onSign(g)},[e,i]),f=p.useCallback(async()=>{if(l){if(!u)throw new Error("safeBundleFlowContext is not set!");return u.postOrderParams.partiallyFillable=c??u.postOrderParams.partiallyFillable,bo(u,t,o,r,d)}if(!e)throw new Error("tradeContext is not set!");return e.postOrderParams.partiallyFillable=c??e.postOrderParams.partiallyFillable,Ao(e,t,o,r,d)},[d,r,l,c,t,u,o,e]);return p.useCallback(()=>f().then(g=>{i.onSuccess(g),a({recipient:null}),s(void 0)}).catch(g=>{g instanceof Re||(g instanceof rn?i.onError(g.message):i.onDismiss())}),[f,i,a,s])}function ht(e){const{expertMode:t}=C(U),{isPriceImpactAccepted:o,isRateImpactAccepted:i}=C(se);return p.useMemo(()=>t?!0:e?i:o,[e,t,o,i])}const vo={[D.RateLoading]:{text:n.jsx(an,{})},[D.PriceIsNotSet]:{text:"Enter a price"},[D.ZeroPrice]:{text:"Invalid price. Try increasing input/output amount."},[D.FeeExceedsFrom]:{text:"Sell amount is too small"}},Ne="Place limit order",De="Review limit order";function So(e){const{tradeContext:t,priceImpact:o}=e,i=C(U),r=Oe(),a=ve(),c=ht(!1),s=dt(),u=gt(t,o,i,s),l=s.onOpen,d=i.expertMode,g=sn(d?Ne:De,{doTrade:u,confirmTrade:l});if(!g)return null;if(!a&&r){const x=vo[r];return typeof x=="function"?x():n.jsx(cn,{id:x.id,disabled:!0,children:n.jsx(V,{id:"J/hVSQ",values:{0:x.text}})})}return n.jsx(ln,{doTradeText:Ne,confirmText:De,validation:a,context:g,isExpertMode:d,isDisabled:!c})}const Oo=m.div.withConfig({displayName:"styled__InfoPopup",componentId:"sc-6ecsxt-0"})(["display:flex;position:relative;align-items:center;gap:12px;font-size:14px;line-height:1.3;background:",";border-radius:16px;padding:15px 34px 15px 15px;.icon{--size:32px;display:flex;align-items:center;width:var(--size);height:var(--size);min-width:var(--size);min-height:var(--size);}.icon > svg{--size:32px;width:100%;height:100%;> path{fill:",";}}.content > a{color:var(",");text-decoration:underline;&::after{content:' ↗';display:inline-block;font-size:12px;}}"],({theme:e})=>`linear-gradient(90deg, ${e.bg1} 0%, ${Ie(.03,e.bg1)} 100%)`,({theme:e})=>j(.5,e.text1),L.COLOR_TEXT1),Ro=m(Ye).withConfig({displayName:"styled__CloseIcon",componentId:"sc-6ecsxt-1"})(["--size:16px;cursor:pointer;position:absolute;right:10px;top:10px;stroke-width:3px;transition:opacity 0.2s ease-in-out;height:var(--size);width:var(--size);opacity:0.6;&:hover{opacity:1;}"]);function jo(){const e="limitOrders_showInfoBanner",[t,o]=p.useState(()=>{const r=localStorage.getItem(e);return r!==null?r==="true":!0}),i=()=>{o(!1),localStorage.setItem(e,"false")};return p.useEffect(()=>{localStorage.setItem(e,t.toString())},[t]),t?n.jsxs(Oo,{children:[n.jsx("div",{className:"icon",children:n.jsx(Ze,{src:dn})}),n.jsxs("div",{className:"content",children:["Your order may not fill exactly when the market price reaches your limit price."," ",n.jsx(vt,{to:"/faq/limit-order#how-do-fees-work",children:"Learn more"})]}),n.jsx(Ro,{onClick:()=>i()})]}):null}function q(e,t){return e&&t?e.equalTo(t):e===t}function Lo(e,t){return We(e.inputCurrencyInfo,t.inputCurrencyInfo)&&We(e.outputCurrencyInfo,t.outputCurrencyInfo)&&e.isUnlocked===t.isUnlocked&&e.isRateLoading===t.isRateLoading&&e.showRecipient===t.showRecipient&&e.recipient===t.recipient&&e.widgetActions===t.widgetActions&&e.partiallyFillableOverride[0]===t.partiallyFillableOverride[0]&&e.featurePartialFillsEnabled===t.featurePartialFillsEnabled&&_o(e.rateInfoParams,t.rateInfoParams)&&ko(e.priceImpact,t.priceImpact)&&Fo(e.tradeContext,t.tradeContext)&&Se(e.settingsState,t.settingsState)&&Eo(e.feeAmount,t.feeAmount)&&e.localFormValidation===t.localFormValidation&&e.primaryFormValidation===t.primaryFormValidation}function Eo(e,t){return!e||!t?e===t:e.currency.equals(t.currency)&&e.equalTo(t)}function We(e,t){return e.field===t.field&&e.label===t.label&&e.isIndependent===t.isIndependent&&q(e.amount,t.amount)&&Se(e.receiveAmountInfo,t.receiveAmountInfo)&&ae(e.currency)===ae(t.currency)&&q(e.balance,t.balance)&&q(e.fiatAmount,t.fiatAmount)}function _o(e,t){return e.chainId===t.chainId&&q(e.inputCurrencyAmount,t.inputCurrencyAmount)&&q(e.outputCurrencyAmount,t.outputCurrencyAmount)&&q(e.activeRateFiatAmount,t.activeRateFiatAmount)&&q(e.invertedActiveRateFiatAmount,t.invertedActiveRateFiatAmount)}function ko(e,t){return e.error===t.error&&e.loading===t.loading&&q(e.priceImpact,t.priceImpact)}function Fo(e,t){return!e||!t?e===t:Se(e.postOrderParams,t.postOrderParams)&&e.provider===t.provider&&e.settlementContract===t.settlementContract&&e.chainId===t.chainId&&e.dispatch===t.dispatch&&e.allowsOffchainSigning===t.allowsOffchainSigning&&e.isGnosisSafeWallet===t.isGnosisSafeWallet}const Po=m.div.withConfig({displayName:"styled__Wrapper",componentId:"sc-es022h-0"})(["background:",";border-radius:16px;padding:10px 16px;flex:1 1 70%;min-height:80px;justify-content:space-between;display:flex;flex-flow:row wrap;",""],({theme:e})=>e.grey1,({theme:e})=>e.mediaWidth.upToSmall`
    gap: 10px;
  `),Mo=m.div.withConfig({displayName:"styled__Header",componentId:"sc-es022h-1"})(["display:flex;align-items:center;justify-content:space-between;font-size:13px;font-weight:500;width:100%;color:",";"],({theme:e})=>j(.3,e.text1)),No=m.button.withConfig({displayName:"styled__MarketPriceButton",componentId:"sc-es022h-2"})(["background:",";color:var(",");white-space:nowrap;border:none;font-weight:500;cursor:pointer;border-radius:9px;padding:5px 8px;font-size:11px;&:disabled{cursor:default;opacity:0.6;}"],({theme:e})=>e.bg1,L.COLOR_TEXT1),Do=m.div.withConfig({displayName:"styled__Body",componentId:"sc-es022h-3"})(["display:flex;align-items:center;justify-content:space-between;width:100%;gap:8px;"]),yt=m(un).withConfig({displayName:"styled__NumericalInput",componentId:"sc-es022h-4"})(["display:flex;align-items:center;background:none;border:none;width:100%;text-align:left;&::placeholder{color:",";}"],({theme:e})=>j(.3,e.text1)),Wo=m.button.withConfig({displayName:"styled__ActiveCurrency",componentId:"sc-es022h-5"})(["display:flex;align-items:center;justify-content:flex-end;border:none;background:none;padding:0;margin:0 0 0 auto;gap:8px;max-width:130px;width:auto;cursor:pointer;"]),Uo=m.span.withConfig({displayName:"styled__ActiveSymbol",componentId:"sc-es022h-6"})(["color:var(",");font-size:13px;font-weight:500;text-align:right;padding:10px 0;"],L.COLOR_TEXT1),zo=m.div.withConfig({displayName:"styled__ActiveIcon",componentId:"sc-es022h-7"})(["--size:20px;background-color:",";color:var(",");width:var(--size);min-width:var(--size);height:var(--size);min-height:var(--size);border-radius:50%;display:flex;align-items:center;justify-content:center;"],({theme:e})=>e.bg1,L.COLOR_TEXT1),Bo=m(pn).withConfig({displayName:"styled__RateLoader",componentId:"sc-es022h-8"})(["margin:5px;"]);m.div.withConfig({displayName:"styled__EstimatedRate",componentId:"sc-es022h-9"})(["display:flex;width:100%;justify-content:space-between;min-height:42px;margin:0;padding:12px 10px 14px;font-size:13px;border-radius:0 0 16px 16px;font-weight:400;background:",";border:2px solid ",";> b{display:flex;flex-flow:row nowrap;font-weight:normal;text-align:left;color:",";}> b svg{opacity:0.7;transition:opacity 0.2s ease-in-out;&:hover{opacity:1;}}> span > i{font-style:normal;color:",";}"],({theme:e})=>e.bg1,({theme:e})=>e.grey1,({theme:e})=>j(.3,e.text1),({theme:e})=>j(.3,e.text1));const ie=m.div.withConfig({displayName:"styled__DetailsRow",componentId:"sc-1iscs18-0"})(["display:flex;flex-direction:row;justify-content:space-between;align-items:center;text-align:right;min-height:24px;gap:3px;> div:first-child{display:flex;gap:3px;}> div > span{display:flex;}> div > span > p{opacity:0.8;padding:0;margin:0;}> div > span ","{opacity:0.5;transition:opacity 0.2s ease-in-out;&:hover{opacity:1;}}"],mn),Vo=m(rt).withConfig({displayName:"styled__StyledRateInfo",componentId:"sc-1iscs18-1"})(["font-size:13px;font-weight:400;color:var(",");min-height:24px;gap:3px;"],L.COLOR_TEXT1),qo=m.div.withConfig({displayName:"styled__Wrapper",componentId:"sc-bl4ryp-0"})(["position:relative;"]),wt=m.span.withConfig({displayName:"styled__LabelText",componentId:"sc-bl4ryp-1"})(["color:var(",");transition:color 0.15s ease-in-out;"],L.COLOR_TEXT1),It=m(Ze).withConfig({displayName:"styled__StyledSVG",componentId:"sc-bl4ryp-2"})(["--size:10px;margin:0 0 0 5px;width:var(--size);height:var(--size);> path{fill:var(",");transition:fill 0.15s ease-in-out;}&.expanded{transform:rotate(180deg);}"],L.COLOR_TEXT1),Ko=m(Qe).withConfig({displayName:"styled__StyledMenuButton",componentId:"sc-bl4ryp-3"})(["background:none;border:none;outline:none;margin:0;position:relative;cursor:",";opacity:",";display:flex;align-items:center;background:",";padding:4px 10px;border-radius:8px;&:hover{background:",";> ",",> "," > path{fill:",";color:",";}}"],({disabled:e})=>e?"inherit":"pointer",({disabled:e})=>e?"0.7":"1",({theme:e})=>e.bg3,({theme:e})=>e.bg2,wt,It,({theme:e})=>e.white,({theme:e})=>e.white),Xo=m(Je).withConfig({displayName:"styled__StyledMenuList",componentId:"sc-bl4ryp-4"})(["box-shadow:0 4px 8px 0 ",";background:",";border-radius:8px;z-index:2;min-width:100%;right:0;position:absolute;white-space:nowrap;text-align:left;padding:6px;"],({theme:e})=>j(.95,e.shadow1),({theme:e})=>e.bg1),Go=m(be).withConfig({displayName:"styled__StyledMenuItem",componentId:"sc-bl4ryp-5"})(["padding:6px 12px;color:var(",");font-size:13px;cursor:pointer;border-radius:8px;font-weight:400;transition:background 0.1s ease-in-out;&:hover{background:",";color:",";}"],L.COLOR_TEXT1,({theme:e})=>e.bg2,({theme:e})=>e.white);function Tt(e){const{isPartiallyFillable:t,className:o,partiallyFillableOverride:[i]}=e,r=i??t?"This order can be partially filled":"This order will either be filled completely or not filled.";return n.jsxs(ie,{className:o,children:[n.jsxs("div",{children:[n.jsx("span",{children:n.jsx("p",{children:"Order type"})})," ",n.jsx(ye,{content:r})]}),n.jsx(Ho,{...e})]})}const oe=["Partially fillable","Fill or kill"];function Ho({isPartiallyFillable:e,featurePartialFillsEnabled:t,partiallyFillableOverride:o}){const[i,r]=o,a=i??e,[c]=a?oe:[...oe].reverse(),s=l=>r(l===oe[0]),u=!t;return n.jsx(Ae,{children:({isExpanded:l})=>n.jsxs(qo,{children:[n.jsxs(Ko,{disabled:u,children:[n.jsx(wt,{children:c}),!u&&n.jsx(It,{src:fn,description:"dropdown icon",className:l?"expanded":""})]}),n.jsx(Xo,{portal:!1,children:oe.map(d=>n.jsx(Go,{onSelect:()=>s(d),children:d},d))})]})})}const $o=m.div.withConfig({displayName:"styled__TradeButtonBox",componentId:"sc-2mee6f-0"})(["margin:10px 0 0;display:flex;gap:10px;flex-direction:column;"]),Ue=m.div.withConfig({displayName:"styled__FooterBox",componentId:"sc-2mee6f-1"})(["display:flex;flex-flow:column wrap;margin:0 4px;padding:0;"]),Yo=m.div.withConfig({displayName:"styled__RateWrapper",componentId:"sc-2mee6f-2"})(["display:grid;grid-template-columns:auto 150px;gap:6px;text-align:right;"," ","{font-size:21px;}"],({theme:e})=>e.mediaWidth.upToSmall`
    display: flex;
    flex-flow: column wrap;
  `,yt),Zo=m(rt).withConfig({displayName:"styled__StyledRateInfo",componentId:"sc-2mee6f-3"})(["padding-top:8px;gap:4px;font-size:13px;min-height:24px;display:grid;grid-template-columns:max-content auto;"]),Qo=m(Tt).withConfig({displayName:"styled__StyledOrderType",componentId:"sc-2mee6f-4"})(["font-size:13px;"]);m.div.withConfig({displayName:"styled__SmallVolumeWarningBanner",componentId:"sc-2mee6f-5"})(["display:flex;align-items:center;background:",";color:",";gap:10px;border-radius:10px;margin:8px auto 0;padding:16px 12px;font-size:14px;font-weight:500;line-height:1.2;> svg{display:block;width:34px;height:21px;}> svg > path{fill:",";}"],({theme:e})=>e.darkMode?j(.9,e.alert):j(.85,e.alert),({theme:e})=>Te(e.darkMode?0:.15,e.alert),({theme:e})=>e.alert);function Jo(){const{orderKind:e}=C(at);return p.useMemo(()=>e===R.OrderKind.SELL,[e])}function ei(){const{provider:e}=St.useWeb3React(),{chainId:t,account:o}=le(),{allowsOffchainSigning:i}=xn(),r=gn(),a=M(),c=hn(),s=Ot(),u=yn(),l=te(),d=pe(),f=C(U),{partialFillsEnabled:g}=de();if(!t||!o||!a.inputCurrencyAmount||!a.outputCurrencyAmount||!a.inputCurrency||!a.outputCurrency||!e||!c||!u)return null;const x=!!r,h=a.recipient||a.recipientAddress,y=a.recipientAddress||a.recipient||o,T=a.inputCurrency,I=a.outputCurrency,v=G.fromRawAmount(a.inputCurrency,0),b=l.response?.id||void 0,S=g&&f.partialFillsEnabled;return{chainId:t,settlementContract:c,allowsOffchainSigning:i,isGnosisSafeWallet:x,dispatch:s,provider:e,appData:u,rateImpact:d,postOrderParams:{class:R.OrderClass.LIMIT,kind:a.orderKind,account:o,chainId:t,sellToken:T,buyToken:I,recipient:y,recipientAddressOrName:h,allowsOffchainSigning:i,feeAmount:v,inputAmount:a.inputCurrencyAmount,outputAmount:a.outputCurrencyAmount,sellAmountBeforeFee:a.inputCurrencyAmount,partiallyFillable:S,appData:u,quoteId:b}}}function ze(e){const t=typeof e=="number"?new Date(e*1e3):e,[o,i]=t.toISOString().split(":");return[o,i].join(":")}function Be(e){const t=typeof e=="number"?new Date(e*1e3):e,o=new Date().getTimezoneOffset()*60*1e3;return new Date(t.getTime()-o).toISOString().replace("Z","")}function Ve(){const e=Date.now();return[qe(new Date(e+ro)),qe(new Date(e+ao))]}function qe(e){return new Date(new Date(e.setMilliseconds(0)).setSeconds(0))}function ti(e,t){if(e){const o=new Date(e*1e3);if(o>t)return o}return t}function ni(){const e=new Date().getTimezoneOffset(),t=Math.abs(e),o=e<0?"+":"-",i=Math.floor(t/60).toString().padStart(2,"0"),r=Math.floor(t%60).toString().padStart(2,"0");return`${o}${i}:${r}`}const oi=m.div.withConfig({displayName:"styled__Wrapper",componentId:"sc-wizteu-0"})(["background:",";border-radius:16px;padding:10px 16px;min-height:",";justify-content:space-between;display:flex;flex-flow:row wrap;",""],({theme:e})=>e.grey1,({minHeight:e})=>e||"80px",({inline:e})=>e&&`
    justify-content: space-between;

    > span {
      flex: 1;
    }

    > button {
      width: auto;
    }
  `),ii=m.span.withConfig({displayName:"styled__Label",componentId:"sc-wizteu-1"})(["display:flex;align-items:center;justify-content:space-between;font-size:13px;font-weight:500;width:100%;color:",";"],({theme:e})=>j(.3,e.text1)),ri=m(Qe).withConfig({displayName:"styled__Current",componentId:"sc-wizteu-2"})(["color:var(",");font-size:",";letter-spacing:",";font-weight:500;display:flex;align-items:center;justify-content:space-between;background:none;border:0;outline:none;margin:0;padding:0;white-space:nowrap;cursor:pointer;width:100%;text-overflow:ellipsis;overflow:hidden;"," &:hover{text-decoration:underline;}> span{display:inline-block;}> svg{margin:0 0 0 auto;}"],L.COLOR_TEXT1,({$custom:e})=>e?"12px":"100%",({$custom:e})=>e?"-0.3px":"0",({theme:e})=>e.mediaWidth.upToSmall`
    font-size: 21px;
  `),ai=m(Je).withConfig({displayName:"styled__ListWrapper",componentId:"sc-wizteu-3"})(["display:block;background:",";box-shadow:",";margin:15px 0 0 0;padding:10px 15px;border-radius:20px;outline:none;list-style:none;position:relative;z-index:2;min-width:120px;"],({theme:e})=>e.bg1,({theme:e})=>e.boxShadow2),Ke=m(be).withConfig({displayName:"styled__ListItem",componentId:"sc-wizteu-4"})(["color:var(",");background:none;border:0;outline:none;margin:0 0 10px 0;padding:5px;cursor:pointer;font-size:16px;font-weight:400;position:relative;:hover{text-decoration:underline;}"],L.COLOR_TEXT1),si=m.input.withConfig({displayName:"styled__CustomInput",componentId:"sc-wizteu-5"})(["display:flex;cursor:pointer;font-size:21px;border-radius:8px;width:100%;border:1px solid ",";color:var(",");padding:4px 8px;outline:0;background:",";&::-webkit-calendar-picker-indicator{filter:",";}&::-webkit-datetime-edit{color:var(",");}&::-webkit-datetime-edit[disabled]{color:",";}"],({theme:e})=>j(.7,e.text1),L.COLOR_TEXT1,({theme:e})=>e.bg1,({theme:e})=>e.darkMode?"invert(1)":"invert(0)",L.COLOR_TEXT1,({theme:e})=>j(.7,e.text1)),ci=m.label.withConfig({displayName:"styled__CustomLabel",componentId:"sc-wizteu-6"})(["display:flex;flex-flow:column wrap;font-size:15px;font-weight:600;gap:10px;width:100%;"]),li=m.div.withConfig({displayName:"styled__ModalWrapper",componentId:"sc-wizteu-7"})(["display:flex;flex-flow:column wrap;height:100%;width:100%;padding:16px;min-height:150px;"]),di=m.div.withConfig({displayName:"styled__ModalHeader",componentId:"sc-wizteu-8"})(["display:flex;width:100%;justify-content:space-between;padding:0 0 16px;> h3{font-size:21px;margin:0;}"]),ui=m.div.withConfig({displayName:"styled__ModalFooter",componentId:"sc-wizteu-9"})(["display:flex;width:100%;justify-content:space-between;padding:32px 0 0;gap:10px;> button{border-radius:12px;}"]),pi=m.div.withConfig({displayName:"styled__ModalContent",componentId:"sc-wizteu-10"})(["display:flex;flex-flow:column wrap;align-items:flex-start;justify-content:center;padding:16px;background:",";border-radius:12px;"],({theme:e})=>e.grey1),mi=m(Ye).withConfig({displayName:"styled__CloseIcon",componentId:"sc-wizteu-11"})(["height:28px;width:28px;opacity:0.6;transition:opacity 0.3s ease-in-out;&:hover{cursor:pointer;opacity:1;}> line{stroke:var(",");}"],L.COLOR_TEXT1),fi={year:"2-digit",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1};function xi(e){const{deadline:t,customDeadline:o,selectDeadline:i,selectCustomDeadline:r}=e,a=p.useRef(null),[[c,s],u]=p.useState(Ve),l=ze(c),d=ze(s),[f,g]=p.useState(null),[x,h]=p.useState("");p.useEffect(()=>{try{const w=new Date(x).getTime(),{timeZone:k}=Intl.DateTimeFormat().resolvedOptions();w<c.getTime()?g(`Must be after ${c.toLocaleString()} ${k}`):w>s.getTime()?g(`Must be before ${s.toLocaleString()} ${k}`):g(null)}catch(w){console.error("[DeadlineSelector] Failed to parse input value to Date",x,w),g("Failed to parse date and time provided")}},[s,c,r,x]);const y=p.useMemo(()=>we.find(w=>w===t),[t]),T=p.useMemo(()=>o?new Date(o*1e3).toLocaleString(void 0,fi):"",[o]),I=p.useCallback(w=>{i(w),r(null),a.current?.click()},[r,i]),v=p.useCallback(({target:{value:w}})=>{h(w||Be(c))},[c]),[b,S]=p.useState(!1),_=p.useCallback(()=>{a.current?.click(),S(!0),g(null);const w=Ve();u(w),h(Be(ti(o,w[0])))},[o]),A=p.useCallback(()=>S(!1),[]),E=p.useCallback(()=>{const w=Math.round(new Date(x+ni()).getTime()/1e3);r(w),A()},[A,r,x]);return n.jsxs(oi,{children:[n.jsx(ii,{children:n.jsx(V,{id:"agO/T/"})}),n.jsxs(Ae,{children:[n.jsxs(ri,{ref:a,$custom:!!o,children:[n.jsx("span",{children:o?T:y?.title}),n.jsx(Rt,{size:"18"})]}),n.jsxs(ai,{children:[we.map(w=>n.jsx("li",{children:n.jsx(Ke,{onSelect:()=>I(w),children:n.jsx(V,{id:"J/hVSQ",values:{0:w.title}})})},w.value)),n.jsx(Ke,{onSelect:_,children:n.jsx(V,{id:"8Tg/JR"})})]})]}),n.jsx(wn,{isOpen:b,onDismiss:A,children:n.jsxs(li,{children:[n.jsxs(di,{children:[n.jsx("h3",{children:n.jsx(V,{id:"GBqQaF"})}),n.jsx(mi,{onClick:A})]}),n.jsxs(pi,{children:[n.jsxs(ci,{htmlFor:"custom-deadline",children:[n.jsx(V,{id:"OVRiRq"}),n.jsx(si,{type:"datetime-local",id:"custom-deadline",onChange:v,min:l,max:d,value:x,pattern:"[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}",onFocus:w=>{w.target.defaultValue=""}})]}),f&&n.jsx("div",{children:n.jsx(V,{id:"gj2MDZ",values:{error:f}})})]}),n.jsxs(ui,{children:[n.jsx(In,{onClick:A,children:"Cancel"}),n.jsx(Tn,{onClick:E,disabled:!!f,children:n.jsx(V,{id:"TYVnXX"})})]})]})})]})}function gi(){const{deadlineMilliseconds:e,customDeadlineTimestamp:t}=C(U),o=F(pt),i=p.useRef(),r=p.useMemo(()=>we.find(s=>s.value===e),[e]),a=p.useCallback(s=>{o({deadlineMilliseconds:s.value,customDeadlineTimestamp:null}),i.current?.click()},[o]),c=p.useCallback(s=>{o({customDeadlineTimestamp:s})},[o]);return n.jsx(xi,{deadline:r,customDeadline:t,selectDeadline:a,selectCustomDeadline:c})}const Le=J(null);m.div.withConfig({displayName:"styled__FeeTooltipWrapper",componentId:"sc-kbasld-0"})(["display:flex;flex-flow:column wrap;align-items:center;justify-content:center;color:var(",");"],L.COLOR_TEXT1);m.div.withConfig({displayName:"styled__FeeItem",componentId:"sc-kbasld-1"})(["display:flex;flex-flow:",";align-items:flex-start;width:100%;margin:",";padding:",";border-radius:",";background:",";border-top:",";gap:4px;> i{font-size:12px;font-style:normal;color:",";max-width:60%;min-width:50%;font-weight:300;}> span{display:flex;flex-flow:row nowrap;align-items:center;justify-content:space-between;text-align:right;width:100%;}> span > p{margin:0;}"],({highlighted:e})=>e?"row":"column wrap",({highlighted:e})=>e?"10px 0 0":"0",({borderTop:e})=>e?"16px 10px 10px":"10px",({highlighted:e})=>e?"10px":"0",({theme:e,highlighted:t})=>t?e.bg1:"transparent",({theme:e,borderTop:t})=>t?`1px solid ${j(.9,e.text1)}`:"none",({theme:e})=>j(.3,e.text1));const hi=m.div.withConfig({displayName:"LimitOrdersDetails__Wrapper",componentId:"sc-r4kjjj-0"})(["font-size:13px;font-weight:400;color:var(",");padding:8px;"],L.COLOR_TEXT1);m.div.withConfig({displayName:"LimitOrdersDetails__ArrowDownRight",componentId:"sc-r4kjjj-1"})(["display:flex;opacity:0.3;margin:0 3px 0 0;color:var(",");"],L.COLOR_TEXT1);function yi(e){const{executionPrice:t,tradeContext:o,settingsState:i,rateInfoParams:r,limitRateState:a,partiallyFillableOverride:c,featurePartialFillsEnabled:s}=e,{account:u,recipient:l,recipientAddressOrName:d,partiallyFillable:f}=o.postOrderParams,{feeAmount:g,activeRate:x,marketRate:h}=a,y=je(i),T=new Date(y*1e3),I=p.useState(!1),[v]=I;return p.useMemo(()=>{if(!x)return"";const b=v?x.invert():x;return st(b)},[v,x]),n.jsxs(hi,{children:[n.jsx(ie,{children:n.jsx(Vo,{isInvertedState:I,rateInfoParams:r})}),ct.DISPLAY_EXECUTION_TIME,n.jsxs(ie,{children:[n.jsxs("div",{children:[n.jsx("span",{children:n.jsx("p",{children:"Order expires"})}),n.jsx(ye,{content:"If your order has not been filled by this date & time, it will expire. Don't worry - expirations and order placement are free on CoW Swap!"})]}),n.jsx("div",{children:n.jsx("span",{children:T.toLocaleString(void 0,Cn)})})]}),n.jsx(Tt,{isPartiallyFillable:f,partiallyFillableOverride:c,featurePartialFillsEnabled:s}),d&&l!==u&&n.jsxs(ie,{children:[n.jsxs("div",{children:[n.jsx("span",{children:"Recipient"})," ",n.jsx(ye,{content:"The tokens received from this order will automatically be sent to this address. No need to do a second transaction!"})]}),n.jsx("div",{children:n.jsx("span",{title:d,children:bn(d)?An(d):d})})]})]})}function wi(e){const{inputCurrencyInfo:t,outputCurrencyInfo:o,tradeContext:i,priceImpact:r}=e,a=ht(!0),c=C(U),s=C(Le),u=C(K),l=Ce(me),{partialFillsEnabled:d}=de(),{amount:f}=t,{amount:g}=o,x=pe(),h=lt(f,g),y=dt(),T=gt(i,r,c,y),v=x<ne?!a:!1,S=it(f)?n.jsxs(n.Fragment,{children:["Confirm (Approve ",n.jsx(ce,{token:f?.currency.wrapped,length:6})," & Limit order)"]}):"Place limit order";return n.jsx(Hn,{children:n.jsx($n,{title:"Review limit order",inputCurrencyInfo:t,outputCurrencyInfo:o,onConfirm:T,onDismiss:y.onDismiss,isConfirmDisabled:v,priceImpact:r,buttonText:S,children:n.jsxs(n.Fragment,{children:[n.jsx(yi,{limitRateState:u,tradeContext:i,rateInfoParams:h,settingsState:c,executionPrice:s,partiallyFillableOverride:l,featurePartialFillsEnabled:d}),n.jsx(mt,{isConfirmScreen:!0,priceImpact:r})]})})})}function Ee(){const{inputCurrencyAmount:e,outputCurrencyAmount:t,orderKind:o}=M(),i=C(K),r=F(H),a=ft(),c=F(ue),{isRateFromUrl:s}=i;return p.useCallback(u=>{const{activeRate:l,isRateFromUrl:d}=u;if(c(u),l){if(s||d)return;a({activeRate:l,amount:o===R.OrderKind.SELL?e:t,orderKind:o})}l===null&&(o===R.OrderKind.SELL?r({outputCurrencyAmount:null}):r({inputCurrencyAmount:null}))},[o,e,t,a,c,r,s])}const Xe=999,Ii=m.span.withConfig({displayName:"RateImpactIndicator__PercentBox",componentId:"sc-1at7l3o-0"})(["font-size:12px;display:inline-flex;align-items:center;gap:2px;color:",";"],({isPositive:e,isTooLowRate:t,theme:o})=>e?o.success:t?o.danger:o.text1),Ti=m.span.withConfig({displayName:"RateImpactIndicator__ImpactTooltip",componentId:"sc-1at7l3o-1"})(["display:block;font-size:13px;padding:5px 10px;max-width:300px;"]);function Ci({rateImpact:e,inputCurrency:t}){const o=e>0,i=e>Xe,r=e<ne,a=i?">"+Xe:e;if(!e)return null;const c=n.jsxs(Ti,{children:[o&&`Your order will execute when the market price is ${a}% better than the current market price.`,!o&&n.jsxs(n.Fragment,{children:["This price is ",a,"% lower than current market price. You could be selling your"," ",n.jsx(ce,{token:t}),' at a loss! Click on "Market price" to set your limit price to the current market price.']})]});return n.jsx(vn,{wrap:!1,content:c,placement:"bottom",children:n.jsxs(Ii,{isPositive:o,isTooLowRate:r,children:[n.jsxs("span",{children:["(",o&&!i?"+":"",a,"%)"]}),r&&n.jsx($e,{size:14})]})})}const Ge=m.span.withConfig({displayName:"HeadingText__Wrapper",componentId:"sc-178i16l-0"})(["display:flex;flex-flow:row wrap;align-items:flex-start;justify-content:flex-start;text-align:left;gap:0 3px;"]);function bi({inputCurrency:e,currency:t,rateImpact:o}){return t?n.jsxs(Ge,{children:["Limit price",n.jsx(Ci,{inputCurrency:e,rateImpact:o})]}):n.jsx(Ge,{children:"Select input and output"})}function Ai(e,t=!1){if(!e||!Number(e))return new ke(0);const{n:o,d:i}=new jt(e),r=t?[i,o]:[o,i];return new ke(...r)}function vi(){const{chainId:e}=le(),{isInverted:t,activeRate:o,isLoading:i,marketRate:r,feeAmount:a,isLoadingMarketRate:c,typedValue:s,isTypedValue:u,initialRate:l}=C(K),d=Ee(),f=F(ue);C(Le);const[g,x]=p.useState(!1),{inputCurrency:h,outputCurrency:y,inputCurrencyAmount:T,outputCurrencyAmount:I}=M(),v=pe(),b=!!h&&!!y,S=h?.symbol,_=y?.symbol,A=t?y:h,E=t?h:y,w=p.useMemo(()=>{if(u)return s||"";if(!o||!b||o.equalTo(0))return"";const P=t?o.invert():o;return st(P)},[o,b,t,u,s]),k=p.useCallback(()=>{d({activeRate:$(r)?l:r,isTypedValue:!1,isRateFromUrl:!1})},[r,l,d]),N=p.useCallback(P=>{f({typedValue:P}),d({activeRate:Ai(P,t),isTypedValue:!0,isRateFromUrl:!1})},[t,d,f]),B=p.useCallback(()=>{f({isInverted:!t,isTypedValue:!1})},[t,f]),X=p.useMemo(()=>c||!_||!S?!0:r&&!r.equalTo(0)?o?.equalTo(r):!!l&&o?.equalTo(l),[o,r,c,l,S,_]);return p.useEffect(()=>{if(g||$(T)||$(I)||!h||!y)return;const P=Sn(e,h,y)||On(e,T,I),[fe,xe]=[ae(P),ae(h)];f({isInverted:fe!==xe}),x(!0)},[g,e,h,y,T,I,f]),p.useEffect(()=>{x(!1)},[h,y]),n.jsxs(n.Fragment,{children:[n.jsxs(Po,{children:[n.jsxs(Mo,{children:[n.jsx(bi,{inputCurrency:h,currency:A,rateImpact:v}),n.jsx(No,{disabled:X,onClick:k,children:n.jsx("span",{children:"Set to market"})})]}),n.jsxs(Do,{children:[i&&b?n.jsx(Bo,{}):n.jsx(yt,{$loading:!1,id:"rate-limit-amount-input",value:w,onUserInput:N}),n.jsxs(Wo,{onClick:B,children:[n.jsx(Uo,{children:n.jsx(ce,{token:E})}),n.jsx(zo,{children:n.jsx(Lt,{size:12})})]})]})]}),ct.DISPLAY_EST_EXECUTION_PRICE]})}function Si({state:e,featurePartialFillsEnabled:t,onStateChanged:o}){const{expertMode:i,showRecipient:r,partialFillsEnabled:a}=e;return n.jsxs(Rn,{children:[n.jsx(jn,{children:"Interface Settings"}),n.jsx(ge,{title:"Expert Mode",tooltip:"Allow high price impact trades and skip the confirm screen. Use at your own risk.",value:i,toggle:()=>o({expertMode:!i})}),n.jsx(ge,{title:"Custom Recipient",tooltip:"Allows you to choose a destination address for the swap other than the connected one.",value:r,toggle:()=>o({showRecipient:!r})}),n.jsx(ge,{title:"Enable Partial Executions",tooltip:n.jsxs(n.Fragment,{children:["Allow you to chose whether your limit orders will be ",n.jsx("i",{children:"Partially fillable"})," or ",n.jsx("i",{children:"Fill or kill"}),".",n.jsx("br",{}),n.jsx("br",{}),n.jsx("i",{children:"Fill or kill"})," orders will either be filled fully or not at all.",n.jsx("br",{}),n.jsx("i",{children:"Partially fillable"})," orders may be filled partially if there isn't enough liquidity to fill the full amount."]}),disabled:!t,value:t&&a,toggle:()=>o({partialFillsEnabled:!a})})]})}function Oi(){const e=C(U),t=F(pt),[o,i]=p.useState(!1),{partialFillsEnabled:r}=de(),a=p.useCallback(s=>{const{expertMode:u}=s;if(u!==void 0){const l=!e.expertMode&&u,d=e.expertMode&&!u;l?i(!0):d&&t({expertMode:!1})}else t(s)},[e,t]),c=p.useCallback(()=>{t({expertMode:!0}),i(!1)},[t,i]);return n.jsxs(n.Fragment,{children:[n.jsxs(Ae,{children:[n.jsxs(Ln,{children:[n.jsx(En,{}),e.expertMode&&n.jsxs(_n,{children:[n.jsx("span",{children:"🐮"}),n.jsx("span",{children:"🥋"})]})]}),n.jsx(kn,{children:n.jsx(be,{disabled:!0,onSelect:()=>{},children:n.jsx(Si,{state:e,onStateChanged:a,featurePartialFillsEnabled:r})})})]}),n.jsx(Fn,{isOpen:o,onDismiss:()=>i(!1),onEnable:c})]})}const Ri=[{content:"Set any limit price and time horizon"},{content:"FREE order placement and cancellation"},{content:"Place multiple orders using the same balance"},{content:"Always receive 100% of your order surplus"},{content:"Protection from MEV by default"},{content:n.jsxs("span",{children:["NOW with ",n.jsx("b",{children:"partial fills"})," support!"]})}],ee={title:"Want to try out limit orders?",subtitle:"Get started!",orderType:"partially fillable",buttonText:"Get started with limit orders",buttonLink:"https://medium.com/@cow-protocol/cow-swap-improves-the-limit-order-experience-with-partially-fillable-limit-orders-45f19143e87d"};function ji(){const{inputCurrency:e,outputCurrency:t,inputCurrencyAmount:o,outputCurrencyAmount:i,inputCurrencyBalance:r,outputCurrencyBalance:a,inputCurrencyFiatAmount:c,outputCurrencyFiatAmount:s,recipient:u,isUnlocked:l,orderKind:d}=M(),f=C(U),g=Jo(),x=ei(),{feeAmount:h}=C(K),{isLoading:y}=te(),T=lt(o,i),I=Ce(me),{partialFillsEnabled:v}=de(),b=To(),{showRecipient:S,expertMode:_}=f,A=Pn(),E=p.useMemo(()=>d===R.OrderKind.SELL?o:i,[d,o,i]);Yn(E);const w={field:W.INPUT,label:g?"You sell":"You sell at most",currency:e,amount:o,isIndependent:d===R.OrderKind.SELL,balance:r,fiatAmount:c,receiveAmountInfo:null},k={field:W.OUTPUT,label:g?"You receive at least":"You receive exactly",currency:t,amount:i,isIndependent:d===R.OrderKind.BUY,balance:a,fiatAmount:s,receiveAmountInfo:null},N=Oe(),B=ve(),X={inputCurrencyInfo:w,outputCurrencyInfo:k,isUnlocked:l,isRateLoading:y,showRecipient:S,isExpertMode:_,recipient:u,partiallyFillableOverride:I,featurePartialFillsEnabled:v,rateInfoParams:T,priceImpact:A,tradeContext:x,settingsState:f,feeAmount:h,widgetActions:b,localFormValidation:N,primaryFormValidation:B};return n.jsx(Li,{...X})}const Li=Et.memo(e=>{const{inputCurrencyInfo:t,outputCurrencyInfo:o,isUnlocked:i,isRateLoading:r,widgetActions:a,partiallyFillableOverride:c,featurePartialFillsEnabled:s,showRecipient:u,isExpertMode:l,recipient:d,rateInfoParams:f,priceImpact:g,tradeContext:x,settingsState:h,feeAmount:y,localFormValidation:T,primaryFormValidation:I}=e,v=t.currency,b=o.currency,S=p.useMemo(()=>!v||!b?!1:r,[r,v,b]),_=s&&h.partialFillsEnabled,A=F(H),E={amount:t.amount,fiatAmount:t.fiatAmount,balance:t.balance,label:t.label},w={amount:o.amount,fiatAmount:o.fiatAmount,balance:o.balance,label:o.label};console.debug("RENDER LIMIT ORDERS WIDGET",{inputCurrencyInfo:t,outputCurrencyInfo:o});const k={settingsWidget:n.jsx(Oi,{}),lockScreen:i?void 0:n.jsx(Zn,{id:"limit-orders",items:Ri,buttonLink:ee.buttonLink,title:ee.title,subtitle:ee.subtitle,orderType:ee.orderType,buttonText:ee.buttonText,handleUnlock:()=>A({isUnlocked:!0})}),middleContent:n.jsxs(Yo,{children:[n.jsx(vi,{}),n.jsx(gi,{})]}),bottomContent:n.jsxs(n.Fragment,{children:[n.jsx(Ue,{children:n.jsx(Zo,{rateInfoParams:f})}),l&&n.jsx(Ue,{children:n.jsx(Qo,{isPartiallyFillable:_,partiallyFillableOverride:c,featurePartialFillsEnabled:s})}),n.jsx(mt,{priceImpact:g,feeAmount:y}),n.jsx($o,{children:n.jsx(So,{tradeContext:x,priceImpact:g})})]})},N=T===D.FeeExceedsFrom||I===Y.QuoteErrors||I===Y.CurrencyNotSupported||I===Y.WrapUnwrapFlow,B={disableNonToken:!1,compactView:!1,disableNativeSelling:!0,isExpertMode:l,recipient:d,showRecipient:u,isTradePriceUpdating:S,priceImpact:g,disablePriceImpact:N};return n.jsxs(n.Fragment,{children:[n.jsx(Mn,{slots:k,actions:a,params:B,inputCurrencyInfo:t,outputCurrencyInfo:o}),x&&n.jsx(wi,{tradeContext:x,priceImpact:g,inputCurrencyInfo:E,outputCurrencyInfo:w}),i&&n.jsx(jo,{})]})},Lo),Ei=m.div.withConfig({displayName:"Widget",componentId:"sc-11pd08l-0"})(["background:transparent;border-radius:16px;padding:0;"]);m(Ei).withConfig({displayName:"styled__Chart",componentId:"sc-12sdfqe-0"})(["min-height:200px;"]);const _i=new He(1,10);function ki(){const{response:e}=te(),{state:t}=Nn(),o=F(ue),i=t?.inputCurrency,r=t?.outputCurrency;return p.useEffect(()=>{if(!r||!i||!e)return;const{buyAmount:a,sellAmount:c,feeAmount:s}=e.quote,u=G.fromRawAmount(i,s),l=G.fromRawAmount(i,c),d=G.fromRawAmount(r,a);if(l.equalTo(0)||d.equalTo(0))return;const f=Q.fractionLikeToFraction(new re({baseAmount:l,quoteAmount:d})),g=f.subtract(f.multiply(_i.divide(100)));o({marketRate:g,feeAmount:u})},[e,i,r,o]),null}function Fi(){const{inputCurrency:e,outputCurrency:t}=M(),o=F(ue),i=Ee(),[r,a]=p.useState(!1),{price:c,isLoading:s}=Dn(),u=Wn(c);return p.useLayoutEffect(()=>{const l={initialRate:c,isLoading:r?!1:s};r||(l.isTypedValue=!1),o(l)},[r,c,s,o]),p.useLayoutEffect(()=>{!c||r||s||u?.equalTo(c)||(a(!0),i({activeRate:c,isTypedValue:!1,isRateFromUrl:!1}),o({isLoading:s}))},[r,o,i,c,s,u]),p.useLayoutEffect(()=>{a(!1)},[e,t]),null}function Pi(){const{marketRate:e,feeAmount:t}=C(K),{inputCurrencyAmount:o,outputCurrencyAmount:i,orderKind:r}=M(),a=F(Le),c=wo({inputCurrencyAmount:o,outputCurrencyAmount:i,feeAmount:t,marketRate:e,orderKind:r});return p.useEffect(()=>{a(c)},[c,a]),null}function Mi(){return Un(),null}function Ni(){const e=_t(),{search:t,pathname:o}=kt(),i=p.useMemo(()=>new URLSearchParams(t),[t]),r=F(H),a=Ee(),{inputCurrency:c,outputCurrency:s}=M(),u=p.useCallback(()=>{const l=new URLSearchParams(t);l.delete(Fe),l.delete(Pe),e({pathname:o,search:l.toString()},{replace:!0})},[e,o,t]);p.useLayoutEffect(()=>{const l=Me(i.get(Pe)),d=Me(i.get(Fe)),f={},g=c&&l&&+l>=0,x=s&&d&&+d>=0,h=g?he(l,c):null,y=x?he(d,s):null;if(h&&(f.inputCurrencyAmount=Q.serializeFractionToJSON(h),f.orderKind=R.OrderKind.SELL),y&&(f.outputCurrencyAmount=Q.serializeFractionToJSON(y),h||(f.orderKind=R.OrderKind.BUY)),Object.keys(f).length>1&&((c||s)&&setTimeout(u),r(f),h&&y)){const I=new re({baseAmount:h,quoteAmount:y});a({activeRate:I,isTypedValue:!1,isRateFromUrl:!0})}},[i,c,s])}function Di(){return Ni(),null}function Bi(){const{chainId:e,account:t}=le(),{isUnlocked:o}=C(at),i=zn(e,t,R.OrderClass.LIMIT),r=p.useMemo(()=>i.filter(Bn),[i]);return n.jsxs(n.Fragment,{children:[n.jsx(Vn,{orderClass:"limit",slippage:lo}),n.jsx(ki,{}),n.jsx(Mi,{}),n.jsx(Di,{}),n.jsx(Fi,{}),n.jsx(Pi,{}),n.jsxs(Qn,{isUnlocked:o,children:[n.jsx(Jn,{children:n.jsx(ji,{})}),n.jsx(eo,{children:n.jsx(to,{displayOrdersOnlyForSafeApp:!1,orderType:no.LIMIT,orders:r})})]})]})}export{Bi as default};
